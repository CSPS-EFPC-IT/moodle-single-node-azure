{
  "tasks": [
    {
      "environment": {},
      "displayName": "ARM Template deployment: Resource Group scope",
      "alwaysRun": false,
      "continueOnError": false,
      "condition": "succeeded()",
      "enabled": true,
      "timeoutInMinutes": 0,
      "inputs": {
        "deploymentScope": "Resource Group",
        "ConnectedServiceName": "$(serviceConnectionName)",
        "subscriptionName": "$(subscriptionId)",
        "action": "Create Or Update Resource Group",
        "resourceGroupName": "$(resourceGroupName)",
        "location": "$(location)",
        "templateLocation": "Linked artifact",
        "csmFileLink": "",
        "csmParametersFileLink": "",
        "csmFile": "$(System.DefaultWorkingDirectory)/_CSPS-EFPC-IT_moodle-single-node-azure/armTemplates/azuredeploy.json",
        "csmParametersFile": "",
        "overrideParameters": "-armTemplateRepoBaseUrl \"$(armTemplateRepoBaseUrl)\" -customApplicationFqdn \"$(customApplicationFqdn)\" -databaseAdminPassword \"$(databaseAdminPassword)\" -databaseAdminUsername \"$(databaseAdminUsername)\" -databaseBackupRetentionDays $(databaseBackupRetentionDays) -databaseCapacity $(databaseCapacity) -databaseMoodlePassword \"$(databaseMoodlePassword)\" -databaseMoodleUsername \"$(databaseMoodleUsername)\" -databaseStorageMb $(databaseStorageMb) -dataDiskSizeGB $(dataDiskSizeGB) -environmentName \"$(environmentName)\" -fileRepositoryUri \"$(fileRepositoryUri)\" -gatewaySslCertificateUri \"$(gatewaySslCertificateUri)\" -gatewayUserAssignedIdentity $(gatewayUserAssignedIdentity) -location \"$(location)\" -moodleAdminEmail \"$(moodleAdminEmail)\" -moodleAdminPassword \"$(moodleAdminPassword)\" -moodleAdminUsername \"$(moodleAdminUsername)\" -moodleUpgradeKey \"$(moodleUpgradeKey)\" -projectShortName \"$(projectShortName)\" -resourceTags $(resourceTags) -smtpServerFqdn \"$(smtpServerFqdn)\" -smtpServerPrivateIp \"$(smtpServerPrivateIp)\" -virtualMachineTags \"$(virtualMachineTags)\" -virtualNetworkAddressBase \"$(virtualNetworkAddressBase)\" -webServerAdminPassword \"$(webServerAdminPassword)\" -webServerAdminUsername \"$(webServerAdminUsername)\"",
        "deploymentMode": "Incremental",
        "deploymentName": "moodleSingleNode_pipeline",
        "deploymentOutputs": "",
        "addSpnToEnvironment": "false"
      },
      "task": {
        "id": "94a74903-f93f-4075-884f-dc11f34058b4",
        "versionSpec": "3.*",
        "definitionType": "task"
      }
    },
    {
      "environment": {},
      "displayName": "ARM Outputs",
      "alwaysRun": false,
      "continueOnError": false,
      "condition": "succeeded()",
      "enabled": true,
      "timeoutInMinutes": 0,
      "inputs": {
        "ConnectedServiceNameSelector": "ConnectedServiceNameARM",
        "ConnectedServiceNameARM": "$(serviceConnectionName)",
        "resourceGroupName": "$(resourceGroupName)",
        "prefix": "armOutput.",
        "outputNames": "",
        "whenLastDeploymentIsFailed": "fail",
        "deploymentNameFilter": ""
      },
      "task": {
        "id": "584bcff2-3353-4f11-872b-6ba01267a972",
        "versionSpec": "6.*",
        "definitionType": "task"
      }
    },
    {
      "environment": {},
      "displayName": "Task group: SMTP Peering: $(armOutput.virtualNetworkName) <-> $(smtpVirtualNetworkName)",
      "alwaysRun": true,
      "continueOnError": true,
      "condition": "succeededOrFailed()",
      "enabled": true,
      "timeoutInMinutes": 0,
      "inputs": {
        "Vnet1_Name": "$(armOutput.virtualNetworkName)",
        "Vnet1_RGName": "$(resourceGroupName)",
        "Vnet1_ServiceConnection": "$(serviceConnectionName)",
        "Vnet1_SubID": "$(subscriptionId)",
        "Vnet2_Name": "$(smtpVirtualNetworkName)",
        "Vnet2_RGName": "$(smtpResourceGroupName)",
        "Vnet2_ServiceConnection": "$(smtpServiceConnectionName)",
        "Vnet2_SubID": "$(smtpSubscriptionId)"
      },
      "task": {
        "id": "fe63ecb9-0ab0-489c-8f6b-3878c9faa6fd",
        "versionSpec": "3.*",
        "definitionType": "metaTask"
      }
    }
  ],
  "runsOn": [
    "Agent",
    "DeploymentGroup"
  ],
  "revision": 1,
  "createdBy": {
    "displayName": "Patrick Messier",
    "id": "9d7984b5-5f92-6bd6-bfea-23da0d70f9a6",
    "uniqueName": "Patrick.Messier@csps-efpc.gc.ca"
  },
  "createdOn": "2021-01-20T14:04:15.497Z",
  "modifiedBy": {
    "displayName": "Patrick Messier",
    "id": "9d7984b5-5f92-6bd6-bfea-23da0d70f9a6",
    "uniqueName": "Patrick.Messier@csps-efpc.gc.ca"
  },
  "modifiedOn": "2021-01-20T14:04:15.497Z",
  "id": "e29562ad-c156-4ff1-8fb4-f9ac7652d660",
  "name": "Deploy Moodle Single Node",
  "version": {
    "major": 1,
    "minor": 0,
    "patch": 0,
    "isTest": false
  },
  "iconUrl": "https://cdn.vsassets.io/v/M176_20201022.3/_content/icon-meta-task.png",
  "friendlyName": "Deploy Moodle Single Node",
  "description": "",
  "category": "Deploy",
  "definitionType": "metaTask",
  "author": "Patrick Messier",
  "demands": [],
  "groups": [],
  "inputs": [
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "armTemplateRepoBaseUrl",
      "label": "armTemplateRepoBaseUrl",
      "defaultValue": "$(armTemplateRepoBaseUrl)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "customApplicationFqdn",
      "label": "customApplicationFqdn",
      "defaultValue": "$(customApplicationFqdn)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "databaseAdminPassword",
      "label": "databaseAdminPassword",
      "defaultValue": "$(databaseAdminPassword)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "databaseAdminUsername",
      "label": "databaseAdminUsername",
      "defaultValue": "$(databaseAdminUsername)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "databaseBackupRetentionDays",
      "label": "databaseBackupRetentionDays",
      "defaultValue": "$(databaseBackupRetentionDays)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "databaseCapacity",
      "label": "databaseCapacity",
      "defaultValue": "$(databaseCapacity)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "databaseMoodlePassword",
      "label": "databaseMoodlePassword",
      "defaultValue": "$(databaseMoodlePassword)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "databaseMoodleUsername",
      "label": "databaseMoodleUsername",
      "defaultValue": "$(databaseMoodleUsername)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "databaseStorageMb",
      "label": "databaseStorageMb",
      "defaultValue": "$(databaseStorageMb)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "dataDiskSizeGB",
      "label": "dataDiskSizeGB",
      "defaultValue": "$(dataDiskSizeGB)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "environmentName",
      "label": "environmentName",
      "defaultValue": "$(environmentName)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "fileRepositoryUri",
      "label": "fileRepositoryUri",
      "defaultValue": "$(fileRepositoryUri)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "gatewaySslCertificateUri",
      "label": "gatewaySslCertificateUri",
      "defaultValue": "$(gatewaySslCertificateUri)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "gatewayUserAssignedIdentity",
      "label": "gatewayUserAssignedIdentity",
      "defaultValue": "$(gatewayUserAssignedIdentity)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "location",
      "label": "location",
      "defaultValue": "$(location)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "moodleAdminEmail",
      "label": "moodleAdminEmail",
      "defaultValue": "$(moodleAdminEmail)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "moodleAdminPassword",
      "label": "moodleAdminPassword",
      "defaultValue": "$(moodleAdminPassword)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "moodleAdminUsername",
      "label": "moodleAdminUsername",
      "defaultValue": "$(moodleAdminUsername)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "moodleUpgradeKey",
      "label": "moodleUpgradeKey",
      "defaultValue": "$(moodleUpgradeKey)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "projectShortName",
      "label": "projectShortName",
      "defaultValue": "$(projectShortName)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "resourceGroupName",
      "label": "resourceGroupName",
      "defaultValue": "$(resourceGroupName)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "resourceTags",
      "label": "resourceTags",
      "defaultValue": "$(resourceTags)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {
        "EndpointFilterRule": ""
      },
      "name": "serviceConnectionName",
      "label": "serviceConnectionName",
      "defaultValue": "$(serviceConnectionName)",
      "required": true,
      "type": "connectedService:AzureRM",
      "helpMarkDown": "Select the Azure Resource Manager service connection having access to the selected deployment scope.",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {
        "2af2ebbd-9d53-41c9-9ee7-34adff439bd2": "OpenLearning-STAGING-RG-Connection",
        "69898b94-99f8-4178-bb42-b81a4ecd5289": "LearningPlatform-Web-DEV-RG-Connection",
        "0996f69b-0ca8-4ab9-86dd-5b341737d130": "OpenLearning-RG-Connection",
        "12f4f109-741a-46df-b476-22a218f9058b": "LearningPlatform-Web-STAGING-RG-Connection",
        "67e34b28-8bf6-4b47-a829-7049930adcb6": "LearningPlatform-Web-RG-Connection",
        "83017c9c-6b3e-4bd8-af1d-d4cc7201a42a": "OpenLearning-DEV-RG-Connection",
        "7962d101-188a-4486-9b47-212729e0331d": "LearningContentHosting-DEV-RG-Connection",
        "75ded706-b0d5-4b7a-9e77-f8c501f3802d": "LearningContentHosting-STAGING-RG-Connection",
        "c765ff90-1591-4a25-b9f0-89f4f79a40e8": "LearningContentHosting-RG-Connection",
        "dec08514-dab3-4d31-8164-4fa84df641ee": "AppDev-RG-Connection",
        "2ef27f73-040f-466a-8272-7c8e175085eb": "NetworkingArchitecture-DEV-RG-Connection",
        "2ab963fc-4c3e-4e54-ae4f-2d641b20618b": "WebAnalytics-DEV-RG-Connection",
        "8cf28a7b-4a04-436b-9277-12b0fb3a9409": "WebAnalytics-STAGING-RG-Connection",
        "a5572fae-b83e-4baf-a675-5306f51c4c7b": "WebAnalytics-RG-Connection",
        "9ce19167-afaf-4bda-8d84-6df8f8fdfb40": "KalturaManagementConsole-DEV-RG-Connection",
        "07487aa2-0a6a-482a-8577-a944de95f42e": "KalturaManagementConsole-STAGING-RG-Connection",
        "fb75c709-f277-4341-8887-498a38ffef18": "KalturaManagementConsole-RG-Connection"
      },
      "properties": {},
      "name": "smtpServerFqdn",
      "label": "smtpServerFqdn",
      "defaultValue": "$(smtpServerFqdn)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "smtpServerPrivateIp",
      "label": "smtpServerPrivateIp",
      "defaultValue": "$(smtpServerPrivateIp)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "smtpResourceGroupName",
      "label": "smtpResourceGroupName",
      "defaultValue": "$(smtpResourceGroupName)",
      "required": true,
      "type": "string",
      "helpMarkDown": "Resource Group containing the SMTP VN.",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {
        "EndpointFilterRule": ""
      },
      "name": "smtpServiceConnectionName",
      "label": "smtpServiceConnectionName",
      "defaultValue": "$(smtpServiceConnectionName)",
      "required": true,
      "type": "connectedService:AzureRM",
      "helpMarkDown": "Service Connection of the RG containing the SMTP server unless the SMTP server is in the same subscription as Vnet1. In that case, use the same service connection as Vnet1_ServiceConnection.",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {
        "2af2ebbd-9d53-41c9-9ee7-34adff439bd2": "OpenLearning-STAGING-RG-Connection",
        "69898b94-99f8-4178-bb42-b81a4ecd5289": "LearningPlatform-Web-DEV-RG-Connection",
        "0996f69b-0ca8-4ab9-86dd-5b341737d130": "OpenLearning-RG-Connection",
        "12f4f109-741a-46df-b476-22a218f9058b": "LearningPlatform-Web-STAGING-RG-Connection",
        "67e34b28-8bf6-4b47-a829-7049930adcb6": "LearningPlatform-Web-RG-Connection",
        "83017c9c-6b3e-4bd8-af1d-d4cc7201a42a": "OpenLearning-DEV-RG-Connection",
        "7962d101-188a-4486-9b47-212729e0331d": "LearningContentHosting-DEV-RG-Connection",
        "75ded706-b0d5-4b7a-9e77-f8c501f3802d": "LearningContentHosting-STAGING-RG-Connection",
        "c765ff90-1591-4a25-b9f0-89f4f79a40e8": "LearningContentHosting-RG-Connection",
        "dec08514-dab3-4d31-8164-4fa84df641ee": "AppDev-RG-Connection",
        "2ef27f73-040f-466a-8272-7c8e175085eb": "NetworkingArchitecture-DEV-RG-Connection",
        "2ab963fc-4c3e-4e54-ae4f-2d641b20618b": "WebAnalytics-DEV-RG-Connection",
        "8cf28a7b-4a04-436b-9277-12b0fb3a9409": "WebAnalytics-STAGING-RG-Connection",
        "a5572fae-b83e-4baf-a675-5306f51c4c7b": "WebAnalytics-RG-Connection",
        "9ce19167-afaf-4bda-8d84-6df8f8fdfb40": "KalturaManagementConsole-DEV-RG-Connection",
        "07487aa2-0a6a-482a-8577-a944de95f42e": "KalturaManagementConsole-STAGING-RG-Connection",
        "fb75c709-f277-4341-8887-498a38ffef18": "KalturaManagementConsole-RG-Connection"
      },
      "properties": {},
      "name": "smtpSubscriptionId",
      "label": "smtpSubscriptionId",
      "defaultValue": "$(smtpSubscriptionId)",
      "required": true,
      "type": "string",
      "helpMarkDown": "Subscription ID of the subscription  containing the SMTP VN.",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "smtpVirtualNetworkName",
      "label": "smtpVirtualNetworkName",
      "defaultValue": "$(smtpVirtualNetworkName)",
      "required": true,
      "type": "string",
      "helpMarkDown": "Name of the SMTP VN.",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "subscriptionId",
      "label": "subscriptionId",
      "defaultValue": "$(subscriptionId)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "virtualMachineTags",
      "label": "virtualMachineTags",
      "defaultValue": "$(virtualMachineTags)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "virtualNetworkAddressBase",
      "label": "virtualNetworkAddressBase",
      "defaultValue": "$(virtualNetworkAddressBase)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "webServerAdminPassword",
      "label": "webServerAdminPassword",
      "defaultValue": "$(webServerAdminPassword)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    },
    {
      "aliases": [],
      "options": {},
      "properties": {},
      "name": "webServerAdminUsername",
      "label": "webServerAdminUsername",
      "defaultValue": "$(webServerAdminUsername)",
      "required": true,
      "type": "string",
      "helpMarkDown": "",
      "groupName": ""
    }
  ],
  "satisfies": [],
  "sourceDefinitions": [],
  "dataSourceBindings": [],
  "instanceNameFormat": "Task group: Deploy Moodle Single Node",
  "preJobExecution": {},
  "execution": {},
  "postJobExecution": {}
}